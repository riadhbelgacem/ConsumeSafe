- name: Read docker registry secret from Vault
  set_fact:
    reg_secret: "{{ lookup('community.hashi_vault.hashi_vault', 'secret=secret/data/boycott/registry token=' + vault_token + ' url=' + vault_addr + ' field=data') }}"

# reg_secret now contains fields like username/password depending on your Vault path

- name: Create Kubernetes secret for registry
  community.kubernetes.k8s:
    kubeconfig: "{{ kubeconfig }}"
    state: present
    definition:
      apiVersion: v1
      kind: Secret
      metadata:
        name: registry-credentials
        namespace: default
      type: kubernetes.io/dockerconfigjson
      data:
        .dockerconfigjson: "{{ reg_secret | json_query('dockerconfigjson') | default('') }}"

